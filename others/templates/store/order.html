<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <!-- 引入样式 -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <link rel="stylesheet" href="../../css/store/common.css">
  <!-- 引入组件库 -->
  <script src="../../js/lib/vue.js"></script>
  <script src="../../js/lib/axios.js"></script>
  <script src="../../js/lib/element-ui-2.14.1.js"></script>
  <script src="../../js/lib/jquery.js"></script>

  <script src="../../js/network/common-request.js"></script>

</head>
<body>

<div id="app">
  <el-container>
    <el-header>
      <el-input class="head-input" placeholder="请输入搜索内容" v-model="searchContent" clearable>
      </el-input>
      <el-button type="primary" plain icon="el-icon-search"></el-button>

      <el-button type="primary" icon="el-icon-refresh" style="float:right" plain onclick="javascript:location.replace(location.href);"></el-button>

    </el-header>
    <el-main>
      <el-table v-loading="loading" :data=orderList :fit='true' type=index border   >
        <el-table-column label="订单编号" prop="orderId" align="center"></el-table-column>
        <el-table-column label="创建时间" prop="createTime" align="center"></el-table-column>
        <el-table-column label="用户账号" prop="userId" align="center"></el-table-column>
        <el-table-column label="订单金额" prop="orderPrice" align="center"></el-table-column>
        <el-table-column  prop="tag" label="支付方式"
                          :filters="[ { text: '未支付', value: '0' },{ text: '支付宝', value: '1' }, { text: '微信支付', value: '2' }]"
                          :filter-method="filterTag" filter-placement="bottom-end" align="center">
          <template slot-scope="scope">
            <el-tag :type="scope.row.payType == 0 ? 'primary' : 'success'" disable-transitions>
              {{showStatus(scope.row.payType)}}
            </el-tag>
          </template>
        </el-table-column>

        <el-table-column label="订单状态"  align="center">
          <template slot-scope="scope">{{ scope.row.status | formatStatus }}</template>
        </el-table-column>

        <el-table-column label="操作" align="center">
          <template slot-scope="scope">
            <el-button size="mini" @click="gotoOrderDetail(scope.row.orderId,scope.$index)">查看订单</el-button>
            <el-button size="mini" type="danger" @click="deleteById(scope.row.userId,scope.$index)">删除</el-button>
          </template>
        </el-table-column>
      </el-table>
    </el-main>
    <el-footer>
      <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page="currentPage"
                     :page-sizes="[10, 20, 30, 50]" :page-size=pageSize layout="total, sizes, prev, pager, next, jumper" :total=total
                     class="el-pagination">
      </el-pagination>
    </el-footer>
  </el-container>

  <el-dialog title="弹窗" :visible.sync="dialogFormVisible">
    <el-form :model="form">
      <el-form-item label="ID" :label-width="formLabelWidth" v-show="false">
        <el-input v-model="form.id" disabled autocomplete="off"></el-input>
      </el-form-item>

    </el-form>
    <div slot="footer" class="dialog-footer">
      <el-button @click="dialogFormVisible = false">取 消</el-button>
      <el-button type="primary" @click="insertItem()">添 加</el-button>
    </div>
  </el-dialog>
</div>
<script>
  let app = new Vue({
    el: '#app',
    data: {
      searchContent: '',
      orderList: [],
      dialogFormVisible: false,
      form: {},
      formLabelWidth: '120px',
      currentPage: 1,
      pageSize: 10,
      total: 0,
      loading: false,
    },
    mounted() {
      this.getOrderList();
    },

    methods: {
      getOrderList() {
        this.loading = true;
        const url = '/manage/order/getOrderListByStoreId';
        const params = new URLSearchParams({
          limit: this.pageSize,
          currentPage: this.currentPage,
          username: this.searchContent,
        })
        request({url, params}).then(res => {
          this.orderList = res.data.orderList;
          this.total = res.data.total;
          console.log(url)
          console.log(res)
          this.loading = false;
        })
      },
      updateStatus(id, status) {},
      deleteById(id, index) {},


      openDialog() {
        this.dialogFormVisible = true;
      },
      insertItem() {
        this.dialogBtnLoding = true;
      },
      // 分页
      handleSizeChange(val) {
        this.pageSize = val;
        this.getOrderList();
        console.log(`每页 ${val} 条`);
      },
      handleCurrentChange(val) {
        this.currentPage = val;
        this.getOrderList();
        console.log(`当前页: ${val}`);
      },
      getPayType(payType){
        if (payType == 1){
          return '支付宝';
        }else if (payType == 2){
          return '微信'
        }
      },
      // 展示商品状态
      showStatus(status) {
        if (status == 0) {
          return '未支付'
        } else if (status == 1) {
          return '支付宝'
        }else if (status == 1) {
          return '微信支付'
        }
      },
      gotoOrderDetail(id, index) {
        console.log(id)
        console.log(index)

        window.location.href = "/store/orderDetail?orderId=" + id;
      },
      filterTag(value, row, column) {
        console.log("筛选" + row.status);
        console.log(value)
        return row.status == value;
      },
    },
    filters:{
      formatStatus(value) {
        if (value === 1) {
          return '待发货';
        } else if (value === 2) {
          return '已发货';
        } else if (value === 3) {
          return '已完成';
        } else if (value === 4) {
          return '已关闭';
        } else if (value === 5) {
          return '无效订单';
        } else {
          return '待付款';
        }
      },
    }
  })
</script>
</body>
</html>
