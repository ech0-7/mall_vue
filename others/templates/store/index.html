<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>商家首页</title>
  <meta name="renderer" content="webkit|ie-comp|ie-stand">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <!--    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />-->
  <meta http-equiv="Cache-Control" content="no-siteapp"/>

  <!-- 改 127.0.0.1:6888 -->
  <!-- http://8.131.77.32:3306  -->
  <link rel="stylesheet" href="../admin/css/font.css">
  <link rel="stylesheet" href="../admin/css/xadmin.css">

  <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script src="../lib/layui/layui.js" charset="utf-8"></script>
  <script type="text/javascript" src="../admin/js/xadmin.js"></script>
  <!-- 引入样式 -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <!-- 引入组件库 -->
  <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.5.6/vue.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.0/axios.js"></script>
</head>
<body>
<div id="app">

  <!-- 顶部开始 -->
  <div class="container">
    <div class="logo"><a href="javascript">商家管理</a></div>
    <div class="left_open">
      <i title="展开左侧栏" class="iconfont">&#xe699;</i>
    </div>
    <ul class="layui-nav right" lay-filter="">
      <li class="layui-nav-item">
        <!-- 商家信息渲染 -->
        <a href="javascript:;">{{storeName}}</a>
        <dl class="layui-nav-child">
          <!-- 二级菜单 -->
          <dd><a @click="passwordDialogVisible = true">修改密码</a></dd>
          <dd><a href="/store/logout">退出</a></dd>
        </dl>
      </li>
      <li class="layui-nav-item to-index"><a href="/">商城首页</a></li>
    </ul>

  </div>
  <!-- 顶部结束 -->
  <!-- 中部开始 -->
  <!-- 左侧菜单开始 -->
  <div class="left-nav">
    <div id="side-nav">
      <ul id="nav">
        <li>
          <a href="javascript:;">
            <i class="iconfont">&#xe6b8;</i>
            <cite>商品管理</cite>
            <i class="iconfont nav_right">&#xe697;</i>
          </a>
          <ul class="sub-menu">
            <li>
              <a _href="/store//goodsPage">
                <i class="iconfont">&#xe6a7;</i>
                <cite>商品列表</cite>
              </a>
            </li>
          </ul>
        </li>
        <li>
          <a>
            <i class="iconfont">&#xe723;</i>
            <cite>订单管理</cite>
            <i class="iconfont nav_right">&#xe697;</i>
          </a>
          <ul class="sub-menu">
            <li>
              <a _href="/store/order">
                <i class="iconfont">&#xe6a7;</i>
                <cite>订单列表</cite>
              </a>
            </li>
          </ul>
        </li>
        <!--        <li>-->
        <!--          <a href="javascript:;">-->
        <!--            <i class="iconfont">&#xe6ce;</i>-->
        <!--            <cite>数据显示</cite>-->
        <!--            <i class="iconfont nav_right">&#xe697;</i>-->
        <!--          </a>-->
        <!--          <ul class="sub-menu">-->
        <!--            <li>-->
        <!--              <a _href="total.html">-->
        <!--                <i class="iconfont">&#xe6a7;</i>-->
        <!--                <cite>数据统计</cite>-->
        <!--              </a>-->
        <!--            </li>-->
        <!--            <li>-->
        <!--              <a _href="seven.html">-->
        <!--                <i class="iconfont">&#xe6a7;</i>-->
        <!--                <cite>七日趋势</cite></cite>-->
        <!--              </a>-->
        <!--            </li>-->
        <!--          </ul>-->
        <!--        </li>-->
      </ul>
    </div>
  </div>
  <!-- <div class="x-slide_left"></div> -->
  <!-- 左侧菜单结束 -->
  <!-- 右侧主体开始 -->
  <div class="page-content">
    <div class="layui-tab tab" lay-filter="xbs_tab" lay-allowclose="false">
      <ul class="layui-tab-title">
        <li class="home"><i class="layui-icon">&#xe68e;</i>我的操作</li>
      </ul>
      <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
          <iframe src='./welcome' frameborder="0" scrolling="yes" class="x-iframe"></iframe>
        </div>
      </div>
    </div>
  </div>
  <div class="page-content-bg"></div>
  <!-- 右侧主体结束 -->
  <!-- 中部结束 -->
  <!-- 底部开始 -->
  <div class="footer">
    <div class="copyright">©2020 ^-^版权所有</div>
  </div>
  <!-- 底部结束 -->

  <!-- 修改密码弹窗 -->
  <el-dialog title="备注订单"
             :visible.sync="passwordDialogVisible" :close-on-click-modal=false
             width="40%">
    <el-form label-width="150px">
      <el-form-item label="原密码：">
        <el-input v-model="oldPassword" show-password rows="3">
        </el-input>
      </el-form-item>
      <el-form-item label="新密码：">
        <el-input v-model="newPassword" show-password rows="3">
        </el-input>
      </el-form-item>
      <el-form-item label="重复新密码：">
        <el-input v-model="newPasswordAgain" show-password rows="3">
        </el-input>
      </el-form-item>
    </el-form>
    <span slot="footer" class="dialog-footer">
         <el-button @click="passwordDialogVisible = false">取 消</el-button>
         <el-button type="primary" @click="changePassword">确 定</el-button>
       </span>
  </el-dialog>


</div>
</body>
</html>
<script>
  let app = new Vue({
    el: '#app',
    data: {
      storeName: '',
      passwordDialogVisible: false, // 修改密码对话框
      oldPassword: '',
      newPassword: '',
      newPasswordAgain: '',

    },
    created() {
      this.init();
    },
    methods: {
      init() {
        axios.post("/store/init").then(
            responce => {
              let data = responce.data;
              if (data.code == 0) {
                this.storeName = data.respMap.storeName;
              }
            }
        )
      },
      // 修改密码
      changePassword() {
        if (this.oldPassword == '') {
          this.$message.error('原密码不能为空！');
          return;
        }
        if (this.newPassword == '') {
          this.$message.error('新密码不能为空！');
          return;
        }
        if (this.newPasswordAgain == '') {
          this.$message.error('确认密码不能为空！');
          return;
        }
        if (this.newPassword != this.newPasswordAgain) {
          this.$message.error('新密码和确认密码不一致！');
          return;
        }
        const params = new URLSearchParams({
          oldPassword: this.oldPassword,
          newPassword: this.newPassword
        })

        axios.put('/store/changePassword', params).then(res => {
          let data = res.data;
          if (data.code != 0) {
            this.$message.error(data.msg);
            return;
          }
          this.$message.success('密码修改成功');
          setTimeout(() => location.reload(), 2000)
        })
      }
    },

  })
</script>