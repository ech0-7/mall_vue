<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title></title>
  <!-- 旧版本  -->
  <!--    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>-->
  <!--    <script type="text/javascript" src="https://api.map.baidu.com/api?v=2.0&ak=Koy1xZ0kphShm4Fwg9vW3VOe5oqkS3Vs&__ec_v__=20190126"></script>-->
  <!--    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/extension/bmap.min.js"></script>-->
  <!--    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>-->
  <!-- 新版本   -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  <script type="text/javascript"
          src="https://api.map.baidu.com/api?v=2.0&ak=Koy1xZ0kphShm4Fwg9vW3VOe5oqkS3Vs&__ec_v__=20190126"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/extension/bmap.min.js"></script>
  <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>

  <style type="text/css">
    #main {
      margin: 0px auto;
      width: 95%;
      height:580px;
      padding: 10px;

    }
  </style>

</head>
<body>
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div id="main" ></div>

<script type="text/javascript">
  // 基于准备好的dom，初始化echarts实例
  var myChart = echarts.init(document.getElementById('main'));

  // var data = [{
  //     name: '海门',
  //     value: 90
  // },
  //     {
  //         name: '福州',
  //         value: 90
  //     }
  // ];

  var data;

  // 获取所有地址表中的地址信息
  $.ajax({
    url: "/admin/chart/getScatterData1",
    method: "post",
    dataType: "text",
    success: function (temp) {

      var jsonObj = $.parseJSON(temp); //json字符串转化成json对象(jq方法)
      console.log(jsonObj);
      data = jsonObj;
      // show();
    }
  })


  // var geoCoordMap = {
  //     '福建省莆田市涵江区': [119.12257,25.464464],
  //     '福建省福州市晋安区': [119.33458,26.087214],
  // };
  var geoCoordMap;

  // 获取地址表中的经纬度信息
  $.ajax({
    url: "/admin/chart/getScatterData2",
    method: "post",
    dataType: "text",
    success: function (temp) {

      var jsonObj = $.parseJSON(temp); //json字符串转化成json对象(jq方法)
      console.log(jsonObj);
      geoCoordMap = jsonObj;
      show();
    }
  })


  var convertData = function (data) {
    var res = [];
    for (var i = 0; i < data.length; i++) {
      var geoCoord = geoCoordMap[data[i].name];
      if (geoCoord) {
        res.push({
          name: data[i].name,
          value: geoCoord.concat(data[i].value)
        });
      }
    }
    return res;
  };


  function show() {

    option = {

      title: {
        text: '玛卡巴卡商城订单地址分布图',
        subtext: 'data from shop',
        sublink: '/',
        left: 'center'
      },
      tooltip: {
        trigger: 'item'
      },
      bmap: {
        center: [104.114129, 37.550339],
        zoom: 5,
        roam: true,
        mapStyle: {}
      },
      series: [{
        name: '订单地址',
        type: 'scatter',
        coordinateSystem: 'bmap',
        data: convertData(data),
        symbolSize: function (val) {
          return val[2] / 10;
        },
        encode: {
          value: 2
        },
        label: {
          formatter: '{b}',
          position: 'right',
          show: false
        },
        itemStyle: {
          color: 'purple'
        },
        emphasis: {
          label: {
            show: true
          }
        }
      },
        {
          name: '地址',
          type: 'effectScatter',
          coordinateSystem: 'bmap',
          data: convertData(data.sort(function (a, b) {
            return b.value - a.value;
          }).slice(0, 6)),
          symbolSize: function (val) {
            return val[2] / 10;
          },
          encode: {
            value: 2
          },
          showEffectOn: 'render',
          rippleEffect: {
            brushType: 'stroke'
          },
          hoverAnimation: true,
          label: {
            formatter: '{b}',
            position: 'right',
            show: true
          },
          itemStyle: {
            color: 'purple',
            shadowBlur: 10,
            shadowColor: '#333'
          },
          zlevel: 1
        }
      ]
    };

    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
  }
</script>
</body>
</html>
