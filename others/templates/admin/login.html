<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>后台登录</title>
  <meta name="renderer" content="webkit|ie-comp|ie-stand">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
        content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
  <meta http-equiv="Cache-Control" content="no-siteapp"/>
  <link rel="shortcut icon" href="../admin/favicon.ico" type="image/x-icon"/>
  <link rel="stylesheet" th:href="@{../admin/css/font.css}">
  <link rel="stylesheet" th:href="@{../admin/css/xadmin.css}">
  <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript" th:src="@{../lib/layui/layui.js}" charset="utf-8"></script>
  <script type="text/javascript" th:src="@{../admin/js/xadmin.js}"></script>
  <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.5.6/vue.js"></script>
  <script th:inline="javascript" type="text/javascript">
    var ctxPath = [[${#httpServletRequest.getContextPath()}]];
    console.log("ctxPath:" + ctxPath);
  </script>
  <script src="../js/lib/md5.js"></script>

  <script src="https://cdn.bootcdn.net/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
</head>
<body class="login-bg">
<div id="app">
  <div class="login layui-anim layui-anim-up">
    <div class="message">登录</div>
    <div id="darkbannerwrap"></div>

    <form method="post" class="layui-form">
      <input id="uname" name="username" placeholder="用户名" type="text" lay-verify="required" class="layui-input"
             :value="username">
      <hr class="hr15">
      <input name="password" lay-verify="required" placeholder="密码" type="password" class="layui-input"
             :value="password">
      <hr class="hr15">
      <img id="img_captcha" style="float: right" src="/kaptcha" title="点击图片更换验证码" onclick="this.src='/kaptcha'">
      <hr class="hr15">
      <input name="captcha" lay-verify="required" placeholder="验证码" type="text" class="layui-input">
      <hr class="hr15">
      <input value="登录" lay-submit lay-filter="login" style="width:100%;" type="submit">
      <hr class="hr20">
    </form>
  </div>

</div>
</body>
</html>

<script>

  $(function () {
    //一般直接写在一个js文件中
    layui.use(['layer', 'form'], function () {
      var layer = layui.layer
          , form = layui.form;


      //编写监听按钮
      form.on('submit(login)', function (data) {
        let password = data.field.password;
        let username = data.field.username;
        // 将密码转为MD5码
        data.field.password = md5(password);
        console.log(data.field);
        $.ajax({
          url: ctxPath + '/admin/doLogin',
          type: 'post',
          data: data.field,
          dataType: "json",
          success: function (data) {
            console.log(data.status)
            if (data.status == "-1") {
              layer.alert("验证码错误！");
              // 更改验证码  触发图片的点击事件
              $("#img_captcha").click();
            } else if (data.status == "1") {
              $.cookie('username', username, {
                expires: 30
              });
              location.href = '/admin/index';

              // layer.msg("登陆成功", function () {
              //
              // });
            } else {
              layer.alert("登陆失败！");
            }
          }
        });
        return false;

      });
    });
  })
</script>

<script>
  let app = new Vue({
    el: '#app',
    data: {
      username: "",
      password: ""
    },
    methods: {
      readCookie() {
        this.username = $.cookie("username");
        console.log(this.username);
      }
    }
  })
  app.readCookie()
</script>
