<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>订单管理</title>
  <link rel="icon" href="../img/icon.png" type="image/png">
  <style type="text/css"></style>
  <link rel="stylesheet" href="../css/user/personalOrder.css">
  <!-- 引入样式 -->
  <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
  <!-- 引入组件库 -->
  <script src="https://cdn.bootcdn.net/ajax/libs/vue/2.5.6/vue.js"></script>
  <script src="https://unpkg.com/element-ui/lib/index.js"></script>
  <script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.0/axios.js"></script>
  <style>
    /* 控制地址是否显示 */
    .consignee:hover .prompt-01 {
      display: block;
    }
  </style>
</head>
<body>
<div id="app">

  <div class="header">
    <div class="container2">
      <div class="header-nav-left">
        <ul>
          <li class="header-nav-left-area">中国大陆</li>
          <li class="header-nav-left-login"><a href="/user/login">您好,{{nickName}}</a></li>
          <li class="header-nav-left-register"><a href="#">免费注册</a></li>
        </ul>
      </div>
      <div class="header-nav-right">
        <ul>
          <li><a href="#">关于我们</a></li>
          <li><a href="#">购物指南</a></li>
          <li><a href="#">会员中心</a></li>
          <li><a href="/shoppingCart">购物车</a></li>
          <li><a href="/user/toPersonalOrder">我的订单</a></li>
        </ul>
      </div>
    </div>
    <div class="header-main">
      <div class="container2">
        <div class="header-main-left">
          个人中心
        </div>
        <div class="header-main-center">
          <div class="header-main-center-height">
            <div class="header-main-center-height-search">
              <input type="text">
              <span><img src="../img/iconImg/01.png" width="100%" height="100%"></span>
              <button><img src="../img/iconImg/search.png" width="100%" height="100%"></button>
            </div>
            <div class="header-main-center-height-cart">
              <!--              <button><img src="../img/iconImg/购物车.png"><span>我的购物车</span></button>-->
              <el-badge :value=shoppingCartCount class="item">
                <el-button size="small" icon="el-icon-shopping-cart-2">我的购物车</el-button>
              </el-badge>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="header-footer">
      <div class="header-footer-top"></div>
      <div class="header-footer-bottom"></div>
    </div>
  </div>
  <div class="container">
    <!--    <div id="app">-->

    <div class="content">
      <div class="content-left">
        <div class="content-left-img">
          <img src="../img/IconImg/logo.png" width="100%" height="100%">
        </div>
        <div class="content-left-order">我的订单</div>
        <div class="content-left-address">收货地址</div>
        <div class="content-left-message">个人信息</div>
<!--        <div class="content-left-idea">意见建议</div>-->
      </div>
      <div class="content-right">
        <div class="content-right-title">
          我的订单
        </div>
        <div class="content-right-data">
          <div>
            <div class="mod-main mod-comm lefta-box" id="order02">
              <div class="mt">
                <ul class="extra-l">
                  <li class="fore1"><a href="//order.jd.com/center/list.action" class="txt curr">全部订单</a></li>
                  <li><a href="//order.jd.com/center/list.action?s=1" id="ordertoPay"
                         clstag="click|keycount|orderinfo|waitPay"
                         class="txt">待付款</a></li>
                  <li><a href="//order.jd.com/center/list.action?s=128" id="ordertoReceive"
                         clstag="click|keycount|orderinfo|waitReceive"
                         class="txt">待收货</a></li>
                  <li><a href="//club.jd.com/mycomments.aspx" id="ordertoComment" target="_blank" class="txt"
                         clstag="click|keycount|orderinfo|daipingjia">待评价</a></li>
                  <li class="fore2 "><a href="//order.jd.com/center/alwaysbuy.action" id="ordertoBuy"
                                        clstag="click|keycount|orderinfo|changgoutab"><strong>我的常购商品</strong></a></li>

                  <li class="fore2"><a href="//order.jd.com/center/recycle.action?d=1"
                                       clstag="click|keycount|orderlist|dingdanhuishouzhan"
                                       class="ftx-03" id="ordertoRecycle">订单回收站</a></li>
                </ul>
                <div class="extra-r">
                  <div class="search">
                    <input id="ip_keyword" type="text" class="itxt" value="商品名称/商品编号/订单号"
                           style="color: rgb(204, 204, 204);">
                    <a href="javascript:;" class="search-btn" clstag="click|keycount|orderinfo|search">搜索<b></b></a>
                    <a href="#none" clstag="click|keycount|orderlist|gaoji"
                       class="default-btn high-search">高级<b></b></a>
                  </div>
                </div>
              </div>

              <div class="mc">

                <div class="top-search hide">
                  <div class="dl">
                    <span class="label">订单类型：</span>
                    <div class="dd">
                      <a href="list.action?t=&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|quanbuleixing"
                         class="curr">全部类型</a>
                      <a href="list.action?t=0-6-8-9-10-11-13-15-16-17-18-19-21-22-23-24-25-32-33-41-42-49-54-56-112&amp;d=2&amp;s=4096"
                         target="_self" clstag="click|keycount|orderlist|shiwushangpin">实物商品</a>
                      <a href="list.action?t=35-83&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|jipiao">机票</a>
                      <a href="list.action?t=39-111&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|jiudian">酒店</a>
                      <a href="list.action?t=45&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|zuche">租车</a>
                      <a href="list.action?t=47&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|dujia">度假</a>
                      <a href="list.action?t=44&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|jingdian">门票</a>
                      <a href="list.action?t=46&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|huoche">火车</a>
                      <a href="list.action?t=34-62&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|youxi">游戏</a>
                      <a href="list.action?t=37&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|shoujichongzhi">手机充值</a>
                      <a href="list.action?t=43&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|dianyingpiao">电影票</a>
                      <a href="list.action?t=53&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|yanchupiao">演出票</a>
                      <a href="list.action?t=38&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|dianzishu">电子书</a>
                      <a href="list.action?t=58&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|shuziyinyue">数字音乐</a>
                      <a href="list.action?t=57&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|yingyongshangdian">应用商店</a>
                      <a href="list.action?t=28-29-201&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|tuangou">团购</a>
                      <a href="list.action?t=48-64-65&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|baoxian">保险</a>
                      <a href="list.action?t=2&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|duobaodao">夺宝岛</a>
                      <a href="list.action?t=99&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|jiayouka">加油卡</a>
                      <a href="list.action?t=98&amp;d=2&amp;s=4096" target="_self"
                         clstag="click|keycount|orderlist|yiyuanqiangbao">一元抢宝</a>
                    </div>
                  </div>
                  <div class="dl">
                    <a href="#none" clstag="click|keycount|orderlist|fanhui" class="btn-9">返回</a>
                  </div>
                  <a href="#none" clstag="click|keycount|orderlist|closehighserach" class="ts-del"></a>
                </div>

                <table class="td-void order-tb" v-for="(orderNo, index) in orderNoList">
                  <colgroup>
                    <col class="number-col">
                    <col class="consignee-col">
                    <col class="amount-col">
                    <col class="status-col">
                    <col class="operate-col">
                  </colgroup>
                  <thead v-show="index == 0">
                  <tr>
                    <th>
                      <div class="ordertime-cont" :class="{'ordertime-hover':orderTimeHover}">
<!--                        @mouseover="orderTimeHover=true"-->
                        <div class="time-txt">
                          今年内订单<b></b><span class="blank"></span></div>
                        <div class="time-list" v-show=orderTimeHover>
                          <ul>
                            <li><a href="#none" _val="1&amp;s=4096"
                                   clstag="click|keycount|orderlist|zuijinsangeyue"><b></b>近三个月订单</a></li>
                            <li><a href="#none" _val="2&amp;s=4096" clstag="click|keycount|orderlist|jinniannei"><b></b>今年内订单</a>
                            </li>
                            <li><a href="#none" _val="2019&amp;s=4096" clstag="click|keycount|orderlist|2019"><b></b>2019年订单</a>
                            </li>
                            <li><a href="#none" _val="2018&amp;s=4096" clstag="click|keycount|orderlist|2018"><b></b>2018年订单</a>
                            </li>
                            <li><a href="#none" _val="2017&amp;s=4096" clstag="click|keycount|orderlist|2017"><b></b>2017年订单</a>
                            </li>
                            <li><a href="#none" _val="2016&amp;s=4096" clstag="click|keycount|orderlist|2016"><b></b>2016年订单</a>
                            </li>
                            <li><a href="#none" _val="2015&amp;s=4096" clstag="click|keycount|orderlist|2015"><b></b>2015年订单</a>
                            </li>
                            <li><a href="#none" _val="2014&amp;s=4096" clstag="click|keycount|orderlist|2014"><b></b>2014年订单</a>
                            </li>
                            <li><a href="#none" _val="3&amp;s=4096"
                                   clstag="click|keycount|orderlist|before_2014"><b></b>2014年以前订单</a></li>
                          </ul>
                        </div>
                      </div>
                      <div class="order-detail-txt ac">订单详情</div>
                    </th>
                    <th>收货人</th>
                    <th>金额</th>
                    <th>
                      <div class="deal-state-cont" id="status">
                        <div class="state-txt">全部状态<b></b><span class="blank"></span></div>
                        <div class="state-list">
                          <ul>
                            <li value="4096">
                              <a href="#none" clstag="click|keycount|orderlist|quanbuzhuangtai" class="curr"><b></b>全部状态</a>
                            </li>
                            <li value="1">
                              <a href="#none" clstag="click|keycount|orderlist|dengdaifukuan"><b></b>等待付款</a>
                            </li>
                            <li value="128" clstag="click|keycount|orderlist|dengdaishouhuo">
                              <a href="#none"><b></b>等待收货</a>
                            </li>
                            <li value="1024">
                              <a href="#none" clstag="click|keycount|orderlist|yiwancheng"><b></b>已完成</a>
                            </li>
                            <li value="-1">
                              <a href="#none" clstag="click|keycount|orderlist|yiquxiao"><b></b>已取消</a>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </th>
                    <th>操作</th>
                  </tr>
                  </thead>


                  <tbody v-for="(shopOrder, index2) in orderNo.shopOrderList" class="split-tbody parent-131530034574">

                  <tr class="sep-row" v-if="index2 == 0">
                    <td colspan="5"></td>
                  </tr>
                  <!-- 订单头 -->
                  <tr class="tr-th tr-th-split" v-if="index2 == 0">
                    <td colspan="5">
                      <div class="split-row">
                        <span class="gap"></span>
                        <span class="dealtime" :title=orderNo.createTime>{{orderNo.createTime}}</span>
                        <span class="number">
												订单号：
												<a href="#none">{{orderNo.orderNo}}</a></span>
                        <div class="tr-operate">
                          <!--                          <span class="ftx-13 fr">您订单中的商品在不同库房或属不同商家，故拆分为以下订单分开配送，给您带来的不便敬请谅解。</span>-->
                        </div>
                      </div>
                      <div class="split-row split-row02">
                        <span class="gap"></span>
                        <span class="order-consignee">收货人：{{orderNo.shopOrderList[0].receiverName}}</span>
                        <span class="order-count">订单金额：<em>¥{{getOrderMoney(orderNo.shopOrderList)}}</em></span>
                        <div class="tr-operate">
												<span class="order-pay">
													支付方式:
													在线支付</span>
                          <span class="order-status">
													订单状态：已拆分
												</span>
                          <span class="fr">
													<a target="_blank"
                             href="//details.jd.com/normal/item.action?orderid=131530034574&amp;p=1&amp;PassKey=E29071D7357268C3EDE929638F1774B4"
                             class="">查看拆分详情&gt;</a>
												</span>
                        </div>
                        <div class="top-arr"></div>
                      </div>
                    </td>
                  </tr>  <!-- 订单头 -->


                  <!-- 商家头 -->
                  <tr class="tr-th tr-th-02">
                    <td colspan="5">
                      <span class="gap"></span>
                      <span class="dealtime" :title=shopOrder.createTime>{{shopOrder.createTime}}</span>
                      <input type="hidden" id="datasubmit-126295188220" :title=shopOrder.createTime>
                      <span class="number">
												订单号：
												<a name="orderIdLinks" id="idUrl126295188220" target="_blank"
                           href="//details.jd.com/normal/item.action?orderid=126295188220&amp;PassKey=D024C9C40EF9F2E527E912C28686A149"
                           clstag="click|keycount|orderinfo|order_num">{{shopOrder.orderId}}</a>
											</span>
                      <div class="tr-operate">
												<span class="order-shop">
													<span class="shop-txt">{{shopOrder.storeName}}</span>
													<a class="btn-im btn-im-jd" href="#none" title="联系客服"
                             clstag="click|keycount|orderlist|ziyingchatim"></a>
												</span>
                        <a href="#none" clstag="click|keycount|orderlist|dingdanshanchu" class="order-del"
                           _orderid="126295188220"
                           _passkey="9E3636F22BCB87E6023740003758C0E0" title="删除" style="display: none;"></a>
                      </div>
                    </td>
                  </tr>
                  <!-- 商品详情 -->
                  <tr class="tr-bd" id="track126295188220" oty="0,4,64" cxl="0"
                      v-for="(goods,index3) in shopOrder.shopOrderItemList">
                    <td>
                      <div class="goods-item p-100005048930">
                        <div class="p-img">
                          <a :href="serviceUrl + '/user/toShopDetail?id=' + goods.goodsId"
                             clstag="click|keycount|orderinfo|order_product" target="_blank">
                            <img class="" :src="goods.pictureUrl"
                                 :title=goods.description data-lazy-img="done" width="60" height="60">
                          </a>
                        </div>
                        <div class="p-msg">
                          <div class="p-name">
                            <a :href="serviceUrl + '/user/toShopDetail?id=' + goods.goodsId"
                               class="a-link"
                               target="_blank" :title=goods.description>{{goods.description}}</a>
                          </div>
                          <div class="p-extra">
                            <ul class="o-info">
                              <li><span class="o-match J-o-match" data-sku="100005048930"><i></i><em>找搭配</em></span>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
                      <div class="goods-number">
                        x{{goods.count}}
                      </div>
                      <div class="goods-repair">
                        <a href="//myjd.jd.com/repair/ordersearchlist.action?searchString=126295188220" target="_blank"
                           clstag="click|keycount|orderinfo|order_repair">
                          申请售后
                        </a>
                      </div>
                      <div class="clr"></div>
                    </td>
                    <td rowspan="1">
                      <div class="consignee tooltip">
                        <span class="txt">{{shopOrder.receiverName}}</span><b></b>
                        <div class="prompt-01 prompt-02">
                          <div class="pc">
                            <strong>{{shopOrder.receiverName}}</strong>
                            <p>{{shopOrder.orderAddress}}</p>
                            <p>{{shopOrder.receiverPhone}}</p>
                          </div>
                          <div class="p-arrow p-arrow-left"></div>
                        </div>
                      </div>
                    </td>
                    <td rowspan="1">
                      <div class="amount">
                        <span>¥{{goods.money}}</span> <br>
                        <span class="ftx-13">在线支付</span>
                      </div>
                    </td>
                    <td rowspan="1">
                      <div class="status">
												<span class="order-status ftx-03">
													{{getStatus(orderNo.status)}}
												</span>
                        <br>
                        <a href="//details.jd.com/normal/item.action?orderid=126295188220&amp;PassKey=D024C9C40EF9F2E527E912C28686A149"
                           clstag="click|keycount|orderlist|dingdanxiangqing" target="_blank">订单详情</a>
                      </div>
                    </td>
                    <td rowspan="1" id="operate126295188220">
                      <div class="operate">
                        <div id="pay-button-126295188220" _baina="0"></div>
                        <a class="" target="_blank"
                           href="//club.jd.com/afterComments/orderPublish.action?orderId=126295188220">评价</a><br>
                        <a @click="gotoShoppingCart(goods.goodsId, goods.count)" style="cursor: pointer"
                                class="btn-again btn-again-show" target="_blank"><b></b>
                          立即购买
                        </a><br>
                      </div>
                    </td>
                  </tr>


                  <tr class="tr-bd sep-tr-bd">
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                  </tr>
                  </tbody>

                </table>

                <div class="mt20">
                  <div class="pagin fr">

                    <span class="prev-disabled">上一页<b></b></span>
                    <a class="current">1</a> <span class="next-disabled">下一页<b></b></span>
                  </div>
                  <div class="clr"></div>
                </div>


              </div>
            </div>
          </div>
        </div>
        <!--        <div class="content-right-footer"></div>-->
      </div>
    </div>

    <!--    </div>-->
  </div>

</div>
</body>
</html>
<script type="text/javascript" src="../js/lib/jquery-3.4.1.min.js"></script>
<script>
  let app = new Vue({
    el: '#app',
    data: {
      nickName: '',
      shoppingCartCount: 0,
      // serviceUrl: 'http://127.0.0.1:8080',
      serviceUrl: '',
      orderNoList: [],
      orderTimeHover: false,
    },
    mounted() {
      this.getOrderDetail();
      this.init()
    },
    methods: {
      // 获取初始信息
      init() {
        axios.post(this.serviceUrl + '/user/getBaseInfo').then(
            response => {
              let result = response.data;
              let respMap = result.respMap;
              this.shoppingCartCount = respMap.shoppingCartCount;
              this.nickName = respMap.nickName;

            }
        );
      },

      // 返回状态
      getStatus(state){
        if(state == 0){
          return "未支付";
        }else{
          return "已支付";
        }
      },
      // 计算订单金额
      getOrderMoney(shopOrderList){
        let orderTotalMoney = 0.00;
        for (let shopOrder of shopOrderList) {
          orderTotalMoney += shopOrder.orderMoney;
        }
        return orderTotalMoney.toFixed(2);
      },
      // 点击"立即购买"
      gotoShoppingCart(goodsId,count) {
        console.log(goodsId, count);
        const params = new URLSearchParams();
        params.append("goodsId", goodsId);
        params.append("num", count);
        axios.post(this.serviceUrl + '/user/buyItNow',params).then(
            response => {
              let data = response.data;
              if (data.code == 0) {
                window.location.href = this.serviceUrl + "/shoppingCart";
              }
            }
        )
      },

      getOrderDetail() {
        axios.post(this.serviceUrl + '/user/getOrderDetail').then(
            response => {
              let data = response.data;
              if (data.code == 0) {
                console.log(data.data);
                this.orderNoList = data.data;
              }
            }
        )
      }
    }
  })
</script>
<script type="text/javascript">
  $(function () {

    $(".content-left-address").click(function () {
      window.location.href = "/user/address";
    })
    $(".content-left-message").click(function () {
      window.location.href = "/user/info";
    })
    $(".header-main-center-height-cart").click(function () {
      window.location.href = "/shoppingCart";
    })
    $(".header-main-left").click(function () {
      window.location.href = "/user/toIndex";
    })
  })
</script>